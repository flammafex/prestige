<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Vote - Prestige</title>
  <meta name="description" content="Cast your anonymous, verifiable vote">

  <!-- PWA Meta Tags -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Prestige">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Prestige">
  <meta name="msapplication-TileColor" content="#0a0a0f">
  <meta name="msapplication-tap-highlight" content="no">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icon-16.png">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon-180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/icon-167.png">

  <!-- Styles -->
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <noscript>
    <div style="padding: 2rem; text-align: center; background: #1a1a2e; color: #e0e0e0; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <h1 style="margin-bottom: 1rem;">JavaScript Required</h1>
      <p style="max-width: 400px; line-height: 1.6;">Prestige requires JavaScript for cryptographic operations and anonymous voting. Please enable JavaScript to continue.</p>
    </div>
  </noscript>
  <!-- Skip link for keyboard navigation -->
  <a href="#main-content" class="skip-link" style="position: absolute; left: -9999px; top: 0; z-index: 999; padding: 1rem; background: var(--accent); color: white;">Skip to main content</a>
  <style>.skip-link:focus { left: 0; }</style>
  <div class="container">
    <header>
      <a href="/" style="color: inherit; text-decoration: none;"><img src="prestige.webp" width=600></a>
      <p class="tagline">Secret ballot. Public proof.</p>
    </header>

    <main id="main-content">
      <!-- Loading State -->
      <div class="card" id="loading-card">
        <div class="loading">
          <div class="spinner"></div>
          Loading ballot...
        </div>
      </div>

      <!-- Error State -->
      <div class="card hidden" id="error-card">
        <div class="alert alert-error" id="error-message">
          Ballot not found
        </div>
        <a href="/" class="btn btn-secondary btn-block">Back to Home</a>
      </div>

      <!-- Ballot Info -->
      <div class="card hidden" id="ballot-card">
        <div class="card-header">
          <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <h2 class="card-title" id="ballot-question"></h2>
            <span class="badge" id="ballot-status"></span>
          </div>
          <div class="timer" id="ballot-timer" aria-live="polite" aria-atomic="true"></div>
        </div>

        <!-- Petition Section (for ballots in petition status) -->
        <div id="petition-section" class="hidden">
          <div class="petition-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="petition-progress-fill"></div>
            </div>
            <div class="progress-text">
              <span id="petition-current">0</span> / <span id="petition-required">10</span> signatures needed to activate
            </div>
          </div>

          <div id="petition-action">
            <!-- Shown if user can sign -->
            <div id="can-sign-section" class="hidden">
              <p class="hint" style="margin-bottom: 1rem;">Add your signature to help activate this ballot for voting.</p>
              <button type="button" class="btn btn-primary btn-block" id="sign-petition-btn">
                Sign Petition
              </button>
            </div>

            <!-- Shown if user already signed -->
            <div id="already-signed-section" class="hidden">
              <div class="alert alert-success">
                You have signed this petition.
              </div>
            </div>

            <!-- Shown if user cannot sign -->
            <div id="cannot-sign-section" class="hidden">
              <div class="alert alert-info" id="cannot-sign-reason">
                You are not eligible to sign this petition.
              </div>
            </div>
          </div>

          <div class="petition-signatures hidden" id="signatures-list-section">
            <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">Signatures</h4>
            <ul id="signatures-list" class="signatures-list"></ul>
          </div>
        </div>

        <!-- Voting Phase -->
        <div id="voting-section" class="hidden">
          <div id="vote-type-label" class="vote-type-label hidden">Single Choice</div>

          <p style="margin-bottom: 1rem; color: var(--text-secondary);">
            Select your choice. Your vote will be encrypted and anonymous.
          </p>

          <form id="vote-form">
            <ul class="choice-list" id="choices-list"></ul>

            <div class="alert alert-info" style="margin-top: 1rem;">
              Your identity is protected by cryptographic blinding.
              No one will know how you voted.
            </div>

            <button type="submit" class="btn btn-primary btn-block" id="vote-btn" disabled>
              Cast Vote
            </button>
          </form>
        </div>

        <!-- Just Voted (shown immediately after casting vote) -->
        <div id="just-voted-section" class="hidden">
          <div class="alert alert-success">
            Thank you for voting! Your vote has been recorded.
          </div>

          <div id="just-voted-reveal-notice">
            <p style="margin: 1rem 0; color: var(--text-secondary);">
              After voting ends, you'll need to reveal your choice for it to be counted.
              Your reveal data is stored locally in this browser.
            </p>
          </div>
        </div>

        <!-- Already Voted (shown on revisit) -->
        <div id="voted-section" class="hidden">
          <div class="alert alert-info">
            You have already voted on this ballot.
          </div>

          <div id="pending-reveal" class="hidden">
            <p style="margin: 1rem 0; color: var(--text-secondary);">
              After voting ends, you'll need to reveal your choice for it to be counted.
              Your reveal data is stored locally.
            </p>
          </div>
        </div>

        <!-- Reveal Phase -->
        <div id="reveal-section" class="hidden">
          <div class="alert alert-warning">
            Voting has ended. Reveal your choice to have it counted.
          </div>

          <div id="reveal-form-container" class="hidden">
            <p style="margin: 1rem 0; color: var(--text-secondary);">
              Click below to reveal your vote. This proves your commitment was honest.
            </p>
            <button type="button" class="btn btn-primary btn-block" id="reveal-btn">
              Reveal My Vote
            </button>
          </div>

          <div id="already-revealed" class="hidden">
            <div class="alert alert-success">
              Your vote has been revealed and will be counted in the final tally.
            </div>
          </div>

          <div id="no-vote-to-reveal" class="hidden">
            <div class="alert alert-info">
              You didn't vote on this ballot, so there's nothing to reveal.
            </div>
          </div>
        </div>

        <!-- Results Link -->
        <div id="results-link" class="hidden" style="margin-top: 1rem;">
          <a href="#" id="view-results-btn" class="btn btn-secondary btn-block">
            View Results
          </a>
        </div>
      </div>

      <!-- Vote Stats -->
      <div class="card hidden" id="stats-card">
        <div class="card-header">
          <h3 class="card-title">Statistics</h3>
        </div>
        <div class="verification-summary">
          <div class="verification-item">
            <div class="verification-value" id="stat-votes">0</div>
            <div class="verification-label">Votes Cast</div>
          </div>
          <div class="verification-item">
            <div class="verification-value" id="stat-reveals">0</div>
            <div class="verification-label">Revealed</div>
          </div>
          <div class="verification-item">
            <div class="verification-value" id="stat-time">-</div>
            <div class="verification-label" id="stat-time-label">Time Left</div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>Your vote is secret. The results are verifiable.</p>
    </footer>
  </div>

  <!-- PWA Scripts -->
  <script src="/js/offline-queue.js"></script>
  <script src="/js/notifications.js"></script>
  <script src="/js/pwa.js"></script>

  <!-- App Scripts -->
  <script src="/js/api.js"></script>
  <script src="/js/identity.js"></script>
  <script src="/js/crypto.js"></script>
  <script src="/js/gates.js"></script>
  <script src="/js/vote.js"></script>
</body>
</html>
